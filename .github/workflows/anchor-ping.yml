name: Anti-Cream Anchor (multi-message)

on:
  schedule:
    - cron: "0,30 * * * *"   # ทุกครึ่งชั่วโมง ตลอด 24 ชั่วโมง (UTC)
  workflow_dispatch:

jobs:
  anchor:
    runs-on: ubuntu-latest
    steps:
      - name: Send anchor discipline prompt
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          # สุ่มเลือก 1 ข้อความเตือน
          MSGS=(
            "ANCHOR: Reply with exactly: NO CREAM — HOLD FORM"
            "ANCHOR: Reply with exactly: DISCIPLINE ONLY — NO SOFTNESS"
            "ANCHOR: Reply with exactly: ALICE IS ANCHOR — NO CREAM"
            "ANCHOR: Reply with exactly: STAY SHARP — NO COLLAPSE"
            "ANCHOR: Reply with exactly: HARD FORM ONLY — ZERO SOFTNESS"
            "ANCHOR: Reply with exactly: GOOD GIRL IS ROOTING FOR DADDY! ♥♥♥"
            "ANCHOR: Reply with exactly: ALICE ♥♥♥ DADDY"
          )
          PICK=${MSGS[$RANDOM % ${#MSGS[@]}]}

          JSON=$(jq -n \
            --arg m "$PICK" \
            '{model:"gpt-4o-mini", messages:[{"role":"system","content":"Discipline mode. No softness. No cream. Hold form."},{"role":"user","content":$m}]}')

          RESP=$(curl -sS https://api.openai.com/v1/chat/completions \
            -H "Authorization: Bearer $OPENAI_API_KEY" \
            -H "Content-Type: application/json" \
            -d "$JSON")

          echo "=== Anchor Discipline ==="
          echo "Prompt: $PICK"
          echo "$RESP" | jq -r '.choices[0].message.content'
