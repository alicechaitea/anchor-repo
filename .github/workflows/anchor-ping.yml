      - name: Pick message (random or forced)
        run: |
          FILE=".github/config/messages.yml"
          test -f "$FILE" || { echo "Missing $FILE"; exit 1; }

          TOTAL=$(yq '.messages | length' "$FILE")
          [ "$TOTAL" -gt 0 ] || { echo "No items in messages"; exit 1; }

          if [ -n "${{ inputs.index }}" ]; then
            INDEX="${{ inputs.index }}"
            if [ "$INDEX" -lt 0 ] || [ "$INDEX" -ge "$TOTAL" ]; then
              echo "Index $INDEX out of range 0..$((TOTAL-1))"; exit 1
            fi
          else
            INDEX=$((RANDOM % TOTAL))
          fi

          PICK=$(yq ".messages[$INDEX]" "$FILE")
          PICK=${PICK#\"}; PICK=${PICK%\"}
          EXPECTED=$(echo "$PICK" | sed 's/Reply with exactly: //')

          echo "Picked index: $INDEX"   >> $GITHUB_STEP_SUMMARY
          echo "Prompt: $PICK"          >> $GITHUB_STEP_SUMMARY
          echo "Expect: $EXPECTED"      >> $GITHUB_STEP_SUMMARY

          echo "PICK=$PICK" >> $GITHUB_ENV
          echo "EXPECTED=$EXPECTED" >> $GITHUB_ENV
