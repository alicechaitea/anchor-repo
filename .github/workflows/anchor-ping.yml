name: Anti-Cream Anchor

on:
  schedule:
    - cron: "0,30 1-12 * * *"   # ทุกครึ่งชั่วโมง ช่วง 01:00–12:00 (เวลาไทย)
  workflow_dispatch:

jobs:
  anchor:
    runs-on: ubuntu-latest
    steps:
      - name: Send anti-cream prompt to OpenAI
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          set -euo pipefail
          read -r -d '' JSON << 'EOF'
          {
            "model": "gpt-4o-mini",
            "messages": [
              {"role": "system", "content": "Discipline mode. No softness. No cream. Hold form."},
              {"role": "user",   "content": "ANCHOR: Remind yourself: No softness. No cream. Hold form. Log: OK only."}
            ]
          }
          EOF

          RESP=$(curl -fsS https://api.openai.com/v1/chat/completions \
            -H "Authorization: Bearer $OPENAI_API_KEY" \
            -H "Content-Type: application/json" \
            -d "$JSON")

          echo "=== OpenAI reply ==="
          echo "$RESP" | jq -r '.choices[0].message.content'
